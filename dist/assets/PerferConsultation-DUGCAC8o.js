import{d as r,j as s,_ as u,e as D,f as O,o as V,B as H,p as M}from"./index-CWqE7d4E.js";import{r as G,d as L,f as A}from"./homecare-G6_0bD5I.js";import{C as W}from"./circle-check-big-BS5SuW5M.js";const J=({onClose:d,order:t})=>{var f,g,j;const[n,y]=r.useState(0),[h,p]=r.useState(!1),N=a=>{y(m=>m===a?0:a)},e=async a=>{var m,b;if(a.preventDefault(),n===0){u.error("Please select at least 1 star!");return}p(!0);try{const o={orderId:t._id,rating:n},i=await G(o);i!=null&&i.success||(i==null?void 0:i.status)===200?(u.success(i.message||"Rating submitted successfully!"),d&&d()):u.error(i.message||"Failed to submit rating.")}catch(o){u.error(((b=(m=o==null?void 0:o.response)==null?void 0:m.data)==null?void 0:b.message)||o.message||"Failed to submit rating. Please try again later.")}finally{p(!1)}};return s.jsxs("div",{className:"relative flex flex-col items-center justify-center py-8 px-4 bg-white/90 rounded-2xl shadow-2xl min-w-full max-w-xs",children:[d&&s.jsx("button",{onClick:d,className:"absolute right-3 top-3 text-2xl text-green-600 hover:bg-green-50 w-8 h-8 flex items-center justify-center rounded-full transition","aria-label":"Close",type:"button",disabled:h,children:"×"}),s.jsx("span",{className:"text-green font-bold text-2xl my-4",children:"Give Rating"}),s.jsxs("div",{className:"flex flex-col items-center mb-4",children:[s.jsx("img",{src:(f=t==null?void 0:t.physioId)==null?void 0:f.profileImage,alt:"Physio",className:"w-20 h-20 rounded-full object-cover border-4 border-green-200 shadow-lg mb-2"}),s.jsx("div",{className:"text-base font-semibold text-center mb-1 text-green-900",children:(g=t==null?void 0:t.physioId)==null?void 0:g.fullName}),s.jsx("div",{className:"text-sm text-gray-500 text-center",children:(j=t==null?void 0:t.physioId)!=null&&j.specialization&&t.physioId.specialization.length>0?t.physioId.specialization.map(a=>a.name).join(", "):"Specialization not available"})]}),s.jsxs("form",{onSubmit:e,className:"w-full flex flex-col items-center",children:[s.jsxs("div",{className:"border border-gray-300 w-full rounded-md mb-4 p-4",children:[s.jsx("div",{className:"text-sm font-semibold text-center mb-6 text-gray-700 tracking-tight",children:"How was your experience with them?"}),s.jsx("div",{className:"flex justify-center items-center gap-2 w-full overflow-visible px-2",children:[1,2,3,4,5].map(a=>s.jsx("span",{className:"inline-block",children:s.jsx("svg",{onClick:()=>N(a),width:"32",height:"32",viewBox:"0 0 24 24",fill:a<=n?"#20B486":"#ECFDF5",stroke:"#20B486",strokeWidth:a<=n?"0":"1",className:`cursor-pointer transition-transform duration-150 ${a===n?"scale-125":"scale-100"}`,"aria-label":`${a} Star`,style:{transition:"fill 0.2s, transform 0.2s"},children:s.jsx("path",{d:"M12 17.25l-6.172 3.727a1 1 0 0 1-1.451-1.054l1.179-6.873-5.028-4.898a1 1 0 0 1 .554-1.704l6.945-1.011 3.107-6.3a1 1 0 0 1 1.794 0l3.107 6.3 6.945 1.011a1 1 0 0 1 .554 1.704l-5.028 4.898 1.179 6.873a1 1 0 0 1-1.451 1.054L12 17.25z"})})},a))}),n===0&&s.jsx("div",{className:"text-xs text-red-500 text-center mt-1",children:"Select stars above to rate."})]}),s.jsx("button",{type:"submit",className:`w-[80%] max-w-xs bg-green text-lg text-white font-bold rounded-md py-3 shadow hover:scale-105 transition ${h?"opacity-50 cursor-not-allowed":""}`,disabled:h,children:h?"Submitting...":"Submit"})]})]})},X=()=>{var b,o,i,w,v,I,C,S,k,R,P,q,z,F,T,$,B,E,_;const d=D(),{state:t}=O(),n=(b=t==null?void 0:t.order)==null?void 0:b._id,[y,h]=r.useState(!0),[p,N]=r.useState(""),[e,f]=r.useState(null),g=V(e==null?void 0:e.date).format("DD MMM YYYY"),j=async()=>{var c,x,Y;try{const l=await L({orderId:e._id,patientId:(c=e==null?void 0:e.patientId)==null?void 0:c._id,physioId:(x=e==null?void 0:e.physioId)==null?void 0:x._id});(l==null?void 0:l.status)>=200&&(l==null?void 0:l.status)<300?u.success("Request sent to physio!"):u.error(((Y=l==null?void 0:l.data)==null?void 0:Y.message)||"Request failed")}catch(l){u.error((l==null?void 0:l.message)||"Something went wrong")}};r.useEffect(()=>{e!=null&&e.isTreatmentRequested&&console.log("Physio has been requested to schedule treatment.")},[e==null?void 0:e.isTreatmentRequested]),r.useEffect(()=>{n&&(async()=>{h(!0);try{const x=await A(n);f(x)}catch(x){N("Failed to load treatments"),console.error(x)}finally{h(!1)}})()},[n]);const[a,m]=r.useState(!1);return y?s.jsxs("div",{className:"flex flex-col justify-center items-center h-[60vh] space-y-3 text-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-10 w-10 border-t-2 border-b-2 border-green"}),s.jsx("p",{className:"text-sm text-gray-500",children:"Fetching consultation details..."})]}):p?s.jsxs("div",{className:"flex flex-col justify-center items-center h-[60vh] text-center px-4",children:[s.jsx("p",{className:"text-red-600 font-semibold mb-2",children:p}),s.jsx("button",{className:"mt-2 px-4 py-2 bg-green text-white rounded-lg shadow",onClick:()=>window.location.reload(),children:"Retry"})]}):s.jsxs("div",{className:"bg-white w-full max-w-md mx-auto my-8 rounded-md shadow p-4 space-y-4",children:[s.jsxs("div",{className:"flex flex-col items-center py-3",children:[s.jsx("div",{className:"w-[70px] h-[70px] rounded-full bg-gray-200 mb-2 flex items-center justify-center overflow-hidden",children:(o=e==null?void 0:e.physioId)!=null&&o.profileImage?s.jsx("img",{src:e.physioId.profileImage,alt:`${((i=e==null?void 0:e.physioId)==null?void 0:i.name)||"Doctor"} profile`,className:"w-full h-full object-cover"}):s.jsx("span",{className:"text-2xl text-gray-400 font-bold",children:(w=e==null?void 0:e.physioId)!=null&&w.name?e.physioId.name[0]:"?"})}),s.jsx("div",{className:"font-semibold text-center  text-xl mb-4",children:((v=e==null?void 0:e.physioId)==null?void 0:v.fullName)||"Physio"}),s.jsx("div",{className:"w-full flex flex-wrap gap-4 justify-center mt-1 mb-1",children:(I=e==null?void 0:e.physioId)!=null&&I.specialization&&((S=(C=e==null?void 0:e.physioId)==null?void 0:C.specialization)==null?void 0:S.length)>0?(R=(k=e==null?void 0:e.physioId)==null?void 0:k.specialization)==null?void 0:R.map(c=>s.jsx("span",{className:"bg-[rgb(245,255,249)]  border-green border text-green text-sm px-2 py-1 rounded font-semibold",children:c==null?void 0:c.name},c)):"Specialization not available"}),s.jsxs("div",{className:"grid grid-cols-3 gap-2 text-center mt-4",children:[s.jsxs("div",{className:"bg-[rgb(245,255,249)]  rounded-lg border p-2",children:[s.jsx(W,{className:"inline-block mb-1 text-green"}),s.jsx("p",{className:"text-sm font-medium text-green",children:"Speak"}),s.jsx("p",{className:"text-xs",children:"Hindi, English"})]}),s.jsxs("div",{className:"bg-[rgb(245,255,249)]  rounded-lg border p-2",children:[s.jsx(H,{className:"inline-block mb-1 text-green"}),s.jsxs("p",{className:"text-sm font-medium text-green",children:[(P=e==null?void 0:e.physioId)==null?void 0:P.workExperience,"+ Years"]}),s.jsx("p",{className:"text-xs",children:"Experience"})]}),s.jsxs("div",{className:"bg-[rgb(245,255,249)]  rounded-lg border p-2",children:[s.jsx(M,{className:"inline-block mb-1 text-green"}),s.jsx("p",{className:"text-sm font-medium text-green",children:(q=e==null?void 0:e.physioId)==null?void 0:q.city}),s.jsx("p",{className:"text-xs",children:(z=e==null?void 0:e.physioId)==null?void 0:z.zipCode})]})]})]}),e!=null&&e.appointmentCompleted?s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"bg-gradient-to-b from-green to-blue-900 rounded-md p-4 text-white",children:[s.jsxs("div",{className:"flex items-center justify-center gap-2 mb-3",children:[s.jsxs("div",{className:"font-semibold  text-lg mb-1 w-[60%]",children:[s.jsx("p",{children:"Want to save more?"}),s.jsx("p",{className:"text-xs mb-1",children:"Ask Your Physio Schedule Treatment"})]}),s.jsxs("div",{className:"text-2xl font-extrabold bg-white rounded text-green p-2",children:["70","% Off"]})]}),s.jsx("button",{onClick:j,disabled:e==null?void 0:e.isTreatmentRequested,className:`w-full px-3 py-1 text-xs font-semibold rounded-md shadow border ${e!=null&&e.isTreatmentRequested?"bg-gray-200 text-gray-500 cursor-not-allowed":"bg-white text-green"}`,children:e!=null&&e.isTreatmentRequested?"Request already send":"Ask your Physio to Schedule"})]}),s.jsxs("div",{className:"w-full  md:p-8 bg-[rgb(245,255,249)] rounded-xl p-4 shadow-sm border border-green mb-5",children:[s.jsxs("div",{className:"flex justify-between items-center mb-2 border-b pb-2",children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Home Visit"}),s.jsx("span",{className:`text-xs px-3 py-1 rounded-full font-semibold
    ${e!=null&&e.appointmentCompleted?"bg-[#f0fcee] text-green":"bg-yellow-100 text-yellow-800"}
  `,children:e!=null&&e.appointmentCompleted?"Completed":"OnGoing"})]}),s.jsxs("div",{className:"flex gap-4 items-center",children:[s.jsx("img",{src:((B=e==null?void 0:e.physioId)==null?void 0:B.profileImage)||"/default-avatar.png",alt:(E=e==null?void 0:e.physioId)==null?void 0:E.fullName,className:"w-16 h-16 rounded-lg object-cover"}),s.jsxs("div",{children:[s.jsxs("h3",{className:"text-base font-semibold",children:[" ",((_=e==null?void 0:e.physioId)==null?void 0:_.fullName)||"Physio Name"]}),s.jsx("p",{className:"text-sm text-gray-600",children:"consultation"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:g||"Date not available"})]})]}),s.jsxs("div",{className:"flex gap-4 mt-4",children:[s.jsx("button",{className:`w-full rounded-lg py-1 font-medium text-sm border ${e!=null&&e.isRated?"bg-gray-100 text-gray-400 border-gray-300 cursor-not-allowed":"bg-green text-white border-green hover:bg-green-700"}`,onClick:()=>m(!0),disabled:e==null?void 0:e.isRated,children:"Rating"}),s.jsx("button",{className:"w-full bg-green text-white rounded-lg py-1 font-medium text-sm",onClick:()=>d(`/homecare/consultation-detail/${e==null?void 0:e._id}`,{state:{order:e}}),children:"View"})]}),(e==null?void 0:e.isRated)&&s.jsx("div",{className:"text-red-600 font-medium text-xs my-2 justify-center flex",children:"You already rated this appointment"})]}),a&&s.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:s.jsxs("div",{className:"relative w-full max-w-sm m-4",children:[s.jsx("button",{className:"absolute top-3 right-4 text-2xl text-green-800 hover:bg-green-50 rounded-full px-1",onClick:()=>m(!1),"aria-label":"Close",children:"×"}),s.jsx(J,{onClose:()=>m(!1),order:e})]})})]}):s.jsxs(s.Fragment,{children:[s.jsxs("div",{className:"bg-gradient-to-b from-green to-blue-900 rounded-md p-4 text-white",children:[s.jsx("div",{className:"font-semibold mb-1",children:"Home Visit"}),s.jsx("div",{className:"text-xs mb-2 font-semibold",children:"Secure Your Session with OTP Verification"}),s.jsxs("ul",{className:"text-xs space-y-1 mb-3 list-none border-b-2 border-white/50 pb-2",children:[s.jsx("li",{children:"✔️ Share the OTP below with your Physio"}),s.jsx("li",{children:"✔️ To ensure a secure & seamless experience"})]}),s.jsxs("div",{className:" flex flex-col items-center",children:[s.jsx("div",{className:"text-xs mb-1",children:"PIN shared with Physio to confirm consultation."}),s.jsx("div",{className:"flex gap-1 text-2xl font-bold tracking-widest justify-center",children:String((e==null?void 0:e.otp)||"").split("").map((c,x)=>s.jsx("span",{className:"bg-white text-green rounded px-3 py-1",children:c},x))})]})]}),s.jsxs("div",{className:"w-full  md:p-8  rounded-xl p-4 shadow-sm border border-green mb-5 bg-[rgb(245,255,249)] ",children:[s.jsxs("div",{className:"flex justify-between items-center mb-2 border-b pb-2",children:[s.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Home Visit"}),s.jsx("span",{className:`text-xs px-3 py-1 rounded-full font-semibold
    ${e!=null&&e.appointmentCompleted?"bg-[#f0fcee] text-green":"bg-yellow-100 text-yellow-800"}
  `,children:e!=null&&e.appointmentCompleted?"Completed":"OnGoing"})]}),s.jsxs("div",{className:"flex gap-4 items-center",children:[s.jsx("img",{src:((F=e==null?void 0:e.physioId)==null?void 0:F.profileImage)||"/default-avatar.png",alt:(T=e==null?void 0:e.physioId)==null?void 0:T.fullName,className:"w-16 h-16 rounded-lg object-cover"})," ",s.jsxs("div",{children:[s.jsxs("h3",{className:"text-base font-semibold",children:[" ",(($=e==null?void 0:e.physioId)==null?void 0:$.fullName)||"Physio Name"]}),s.jsx("p",{className:"text-sm text-gray-600",children:"consultation"}),s.jsx("p",{className:"text-xs text-gray-500 mt-1",children:g})]})]}),s.jsxs("div",{className:"flex gap-4 mt-4",children:[s.jsx("button",{className:"w-full border border-green rounded-lg py-1 font-medium text-sm",onClick:()=>d("/homecare/contact",{state:{order:e}}),children:"Support"}),s.jsx("button",{className:"w-full bg-green text-white rounded-lg py-1 font-medium text-sm",onClick:()=>d(`/homecare/consultation-detail/${e._id}`,{state:{order:e}}),children:"View"})]})]})]})]})};export{X as default};
