import{d as o,e as K,f as Q,j as s,q as X,E as Y}from"./index-DPswVjmk.js";import{h as V}from"./homecare-BVlYjtuZ.js";const R="Home Care";function ee({paid:i,couponType:m,couponValue:a}){let t=i,n=0;return m===1&&a>0?(t=i/(1-a/100),n=t-i):m===0&&a>0&&(t=i+a,n=a),t=Math.round(t*100)/100,n=Math.round(n*100)/100,{original:t,discount:n}}const ae=()=>{var v,D,P,A,S,T,C,L,k,E;const i=o.useRef(),m=K(),{state:a}=Q(),t=a==null?void 0:a.order,n=(a==null?void 0:a.type)??"appointment",[e,H]=o.useState(null),[_,j]=o.useState(!0),[N,p]=o.useState(null);o.useEffect(()=>{const r=async()=>{var l;try{const d=await V(t==null?void 0:t.id,n);H(d.data)}catch(d){console.error("Invoice fetch failed:",d),((l=d==null?void 0:d.response)==null?void 0:l.status)===404?p("Invoice not found."):p("Something went wrong. Please try again.")}finally{j(!1)}};t!=null&&t.id?r():(j(!1),p("Invalid order details."))},[t,n,m]);const y=Number((e==null?void 0:e.amount)??0),b=Number((e==null?void 0:e.couponType)??0),f=Number((e==null?void 0:e.couponDiscount)??0),$=(e==null?void 0:e.couponName)??"Coupon Applied",{original:z,discount:I}=ee({paid:y,couponType:b,couponValue:f}),w=(e==null?void 0:e.invoiceNumber)??"N/A",G=e!=null&&e.createdAt?new Date(e.createdAt).toLocaleDateString():"—",W=((v=e==null?void 0:e.transactionId)==null?void 0:v.transactionId)??"",B=(e==null?void 0:e.patientAddress)??"N/A",O=((D=e==null?void 0:e.patientId)==null?void 0:D.zipCode)??"—",q=(e==null?void 0:e.paymentMode)??"—",U=(e==null?void 0:e.physioName)??"N/A",Z=async()=>{const r=i.current,d=(await X(r,{scale:2,useCORS:!0,backgroundColor:"#fff"})).toDataURL("image/png"),c=new Y("p","mm","a4"),J=c.internal.pageSize.getWidth(),M=c.internal.pageSize.getHeight(),F=c.getImageProperties(d),u=J-20,x=F.height*u/F.width;let h=x,g=10;for(c.addImage(d,"PNG",10,g,u,x),h-=M;h>0;)g=h-x,c.addPage(),c.addImage(d,"PNG",10,g,u,x),h-=M;c.save(`${R.replace(/\s/g,"_")}_${w}_Invoice.pdf`)};return _?s.jsx("div",{className:"min-h-screen flex items-center justify-center text-center py-6 text-gray-500",children:"Loading Invoice..."}):N?s.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center text-center px-6 py-12",children:[s.jsx("img",{src:"/homecare/invoice-failed.png",className:"w-64",alt:"Error"}),s.jsx("p",{className:"text-red-600 text-sm mb-4",children:N}),s.jsx("button",{onClick:()=>m(-1),className:"bg-green text-white px-6 py-2 rounded-md text-sm font-medium",children:"Go Back"})]}):s.jsxs("div",{className:"bg-[#f8fafc] min-h-screen py-6",children:[s.jsxs("div",{ref:i,className:"bg-white w-full max-w-md mx-auto my-6 rounded-lg shadow p-5",style:{fontFamily:"Inter, Arial, sans-serif"},children:[s.jsx("h1",{className:"flex justify-center text-2xl text-green mb-6",children:"Tax Invoice"}),s.jsxs("div",{className:"text-center mb-4",children:[s.jsx("div",{className:"font-semibold text-lg",children:R}),s.jsx("div",{className:"text-xs text-gray-600",children:O})]}),s.jsx("hr",{className:"mb-3"}),s.jsxs("div",{className:"space-y-2 text-sm text-black/90 mb-4",children:[s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"Physio Name :"})," ",U]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"Invoice Number :"})," ",w]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"Service Type :"})," ",(e==null?void 0:e.type)??n]}),n==="treatment"&&((S=(A=(P=e==null?void 0:e.appointmentId)==null?void 0:P.isTreatmentScheduled)==null?void 0:A.treatmentDate)==null?void 0:S.length)>0&&s.jsxs("div",{className:"space-y-1",children:[s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"Service Days :"})," ",(L=(C=(T=e==null?void 0:e.appointmentId)==null?void 0:T.isTreatmentScheduled)==null?void 0:C.treatmentDate)==null?void 0:L.length," ","Day(s)"]}),(k=e==null?void 0:e.appointmentId)==null?void 0:k.isTreatmentScheduled.treatmentDate.map((r,l)=>s.jsxs("div",{className:"ml-2 text-sm text-gray-700",children:[s.jsxs("span",{className:"font-medium",children:["• Day ",l+1,":"]})," ",new Date(r.date).toLocaleDateString()," ",r.isPaid&&s.jsxs("span",{className:"text-green-600 ml-1",children:["[Paid - ",r.paymentMode,"]"]})]},r._id||l))]}),n==="appointment"&&s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"Service Day :"})," ",(E=e==null?void 0:e.appointmentId)==null?void 0:E.date]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"Invoice Date :"})," ",G]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"Transaction Id :"})," ",W||s.jsx("span",{className:"text-gray-400",children:"ID will generate"})]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"Mode of Payment :"})," ",q]})]}),s.jsx("hr",{className:"mb-3"}),s.jsxs("div",{className:"space-y-1 text-sm mb-2",children:[s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"Invoice To :"})," ",(e==null?void 0:e.patientName)??"N/A"]}),s.jsxs("div",{children:[s.jsx("span",{className:"font-medium",children:"Address :"})," ",B]})]}),s.jsxs("div",{className:"bg-gray-50 border p-3 rounded-md mt-4 mb-5",children:[s.jsxs("div",{className:"flex justify-between text-sm",children:[s.jsx("span",{children:n==="appointment"?"Appointment Charges":"Treatment Charges"}),s.jsxs("span",{children:["₹",z.toFixed(2)]})]}),I>0&&s.jsxs("div",{className:"flex justify-between text-sm text-green-700 mt-1",children:[s.jsxs("span",{children:[$," (",b===1?`${f}%`:`₹${f}`,")"]}),s.jsxs("span",{children:["-₹",I.toFixed(2)]})]}),s.jsx("hr",{className:"my-2"}),s.jsxs("div",{className:"flex justify-between font-medium text-base",children:[s.jsx("span",{children:"Total Amount Paid"}),s.jsxs("span",{children:["₹",y.toFixed(2)]})]})]})]}),s.jsx("button",{onClick:Z,className:"block w-full max-w-md mx-auto rounded-md bg-green/90 hover:bg-green text-white text-base py-3 font-semibold mt-2",children:"Download Invoice"})]})};export{ae as default};
