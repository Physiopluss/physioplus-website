import{d as m,e as O,f as q,j as e,q as U,E as Z}from"./index-B-e9AaA1.js";import{h as J}from"./homecare-ChnV4w0_.js";const L="Home Care";function K({paid:c,couponType:o,couponValue:t}){let a=c,n=0;return o===1&&t>0?(a=c/(1-t/100),n=a-c):o===0&&t>0&&(a=c+t,n=t),{original:Math.round(a*100)/100,discount:Math.round(n*100)/100}}const Y=()=>{var w,D,S,A,P,T;const c=m.useRef(),o=O(),{state:t}=q(),a=t==null?void 0:t.order,n=(t==null?void 0:t.type)??"appointment",[s,k]=m.useState(null),[E,j]=m.useState(!0),[N,p]=m.useState(null);m.useEffect(()=>{const d=async()=>{var l;try{const i=await J(a==null?void 0:a._id,n);k(i.data)}catch(i){console.error("Invoice fetch failed:",i),((l=i==null?void 0:i.response)==null?void 0:l.status)===404?p("Invoice not found."):p("Something went wrong. Please try again.")}finally{j(!1)}};a!=null&&a._id?d():(j(!1),p("Invalid order details."))},[a,n]);const y=Number((s==null?void 0:s.amount)??0),b=Number((s==null?void 0:s.couponType)??0),f=Number((s==null?void 0:s.couponDiscount)??0),M=(s==null?void 0:s.couponName)??"Coupon Applied",{original:_,discount:I}=K({paid:y,couponType:b,couponValue:f}),v=(s==null?void 0:s.invoiceNumber)??"N/A",F=s!=null&&s.createdAt?new Date(s.createdAt).toLocaleDateString():"—",R=((w=s==null?void 0:s.transactionId)==null?void 0:w.transactionId)??"",z=(s==null?void 0:s.patientAddress)??"N/A",H=((D=s==null?void 0:s.patientId)==null?void 0:D.zipCode)??"—",$=(s==null?void 0:s.paymentMode)??"—",G=(s==null?void 0:s.physioName)??"N/A",W=async()=>{const d=c.current,i=(await U(d,{scale:2,useCORS:!0,backgroundColor:"#fff"})).toDataURL("image/png"),r=new Z("p","mm","a4"),B=r.internal.pageSize.getWidth(),C=r.getImageProperties(i),u=B-20,x=C.height*u/C.width;let h=x,g=10;for(r.addImage(i,"PNG",10,g,u,x),h-=r.internal.pageSize.getHeight();h>0;)g=h-x,r.addPage(),r.addImage(i,"PNG",10,g,u,x),h-=r.internal.pageSize.getHeight();r.save(`${L.replace(/\s/g,"_")}_${v}_Invoice.pdf`)};return E?e.jsx("div",{className:"min-h-screen flex items-center justify-center text-center py-6 text-gray-500",children:"Loading Invoice..."}):N?e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center text-center px-6 py-12",children:[e.jsx("img",{src:"/homecare/invoice-failed.png",className:"w-64",alt:"Error"}),e.jsx("p",{className:"text-red-600 text-sm mb-4",children:N}),e.jsx("button",{onClick:()=>o(-1),className:"bg-green text-white px-6 py-2 rounded-md text-sm font-medium",children:"Go Back"})]}):e.jsxs("div",{className:"bg-[#f8fafc] min-h-screen py-6",children:[e.jsxs("div",{ref:c,className:"bg-white w-full max-w-md mx-auto my-6 rounded-lg shadow p-5",style:{fontFamily:"Inter, Arial, sans-serif"},children:[e.jsx("h1",{className:"flex justify-center text-2xl text-green mb-6",children:"Tax Invoice"}),e.jsxs("div",{className:"text-center mb-4",children:[e.jsx("div",{className:"font-semibold text-lg",children:L}),e.jsx("div",{className:"text-xs text-gray-600",children:H})]}),e.jsx("hr",{className:"mb-3"}),e.jsxs("div",{className:"space-y-2 text-sm text-black/90 mb-4",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Physio Name :"})," ",G]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Invoice Number :"})," ",v]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Service Type :"})," ",(s==null?void 0:s.type)??n]}),n==="treatment"&&((P=(A=(S=s==null?void 0:s.appointmentId)==null?void 0:S.isTreatmentScheduled)==null?void 0:A.treatmentDate)==null?void 0:P.length)>0&&e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Service Days :"})," ",s.appointmentId.isTreatmentScheduled.treatmentDate.length," ","Day(s)"]}),s.appointmentId.isTreatmentScheduled.treatmentDate.map((d,l)=>e.jsxs("div",{className:"ml-2 text-sm text-gray-700",children:[e.jsxs("span",{className:"font-medium",children:["• Day ",l+1,":"]})," ",new Date(d.date).toLocaleDateString()," ",d.isPaid&&e.jsxs("span",{className:"text-green-600 ml-1",children:["[Paid - ",d.paymentMode,"]"]})]},d._id||l))]}),n==="appointment"&&e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Service Day :"})," ",(T=s==null?void 0:s.appointmentId)==null?void 0:T.date]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Invoice Date :"})," ",F]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Transaction Id :"})," ",R||e.jsx("span",{className:"text-gray-400",children:"ID will generate"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Mode of Payment :"})," ",$]})]}),e.jsx("hr",{className:"mb-3"}),e.jsxs("div",{className:"space-y-1 text-sm mb-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Invoice To :"})," ",(s==null?void 0:s.patientName)??"N/A"]}),e.jsxs("div",{children:[e.jsx("span",{className:"font-medium",children:"Address :"})," ",z]})]}),e.jsxs("div",{className:"bg-gray-50 border p-3 rounded-md mt-4 mb-5",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:n==="appointment"?"Appointment Charges":"Treatment Charges"}),e.jsxs("span",{children:["₹",_.toFixed(2)]})]}),I>0&&e.jsxs("div",{className:"flex justify-between text-sm text-green-700 mt-1",children:[e.jsxs("span",{children:[M," (",b===1?`${f}%`:`₹${f}`,")"]}),e.jsxs("span",{children:["-₹",I.toFixed(2)]})]}),e.jsx("hr",{className:"my-2"}),e.jsxs("div",{className:"flex justify-between font-medium text-base",children:[e.jsx("span",{children:"Total Amount Paid"}),e.jsxs("span",{children:["₹",y.toFixed(2)]})]})]})]}),e.jsx("button",{onClick:W,className:"block w-full max-w-md mx-auto rounded-md bg-green/90 hover:bg-green text-white text-base py-3 font-semibold mt-2",children:"Download Invoice"})]})};export{Y as default};
