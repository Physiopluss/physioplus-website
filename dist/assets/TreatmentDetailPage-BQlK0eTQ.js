import{d as c,j as e,W as q,_ as g,X as B,z as H,Y as V,Z as W,$ as X}from"./index-DPswVjmk.js";import{E as Z,C as G,a as J}from"./ellipsis-vertical-ik7FtKHq.js";const K=({patient:r,treatmentId:s,onClose:N,onRescheduleSuccess:b})=>{var k,I,$;const j=((k=r==null?void 0:r.isTreatmentScheduled)==null?void 0:k.treatmentDate)||[],[i,_]=c.useState([]),[v,D]=c.useState({}),[S,T]=c.useState(((I=r==null?void 0:r.isTreatmentScheduled)==null?void 0:I.startTime)||""),[h,C]=c.useState((($=r==null?void 0:r.isTreatmentScheduled)==null?void 0:$.endTime)||""),[p,P]=c.useState(!1),u=(t=30)=>{const n=[];for(let d=0;d<24;d++)for(let l=0;l<60;l+=t){const x=d%12===0?12:d%12,o=l<10?`0${l}`:l,y=d<12?"AM":"PM";n.push(`${x}:${o} ${y}`)}return n},M=t=>{_(n=>n.includes(t)?n.filter(d=>d!==t):[...n,t])},A=async()=>{if(i.some(n=>!v[n])||!S||!h){g.error("Please select all replacement dates and times.");return}try{P(!0);const d=i.map(o=>({id:o,date:new Date(v[o]).toISOString().split("T")[0]})).sort((o,y)=>o.date.localeCompare(y.date)),l=d.map(o=>o.id),x=d.map(o=>o.date);await B({treatmentId:s,dateIds:l,dates:x,startTime:S,endTime:h}),g.success("Treatment rescheduled successfully!"),b&&b()}catch(n){console.error(n),g.error("Failed to reschedule treatment.")}finally{P(!1)}};return e.jsx("div",{className:"fixed inset-0 bg-black/40 z-50 overflow-auto",children:e.jsxs("div",{className:"bg-white w-full h-full p-5 sm:rounded-none sm:max-w-full sm:max-h-full overflow-y-auto",children:[e.jsx("h2",{className:"text-center font-semibold text-base mb-4",children:"Reschedule Treatment Plan"}),e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm font-medium mb-2 text-gray-700",children:"1️⃣ Select dates to reschedule:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:j.map(t=>{const n=new Date(t.date).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"}),d=i.includes(t._id);return e.jsx("button",{type:"button",onClick:()=>M(t._id),className:`px-3 py-1 text-xs rounded-full border ${d?"bg-green text-white border-green":"bg-white text-gray-600 border-gray-300"}`,children:n},t._id)})})]}),i.length>0&&e.jsxs("div",{className:"mb-4",children:[e.jsx("p",{className:"text-sm font-medium mb-2 text-gray-700",children:"2️⃣ Pick new dates:"}),e.jsx("div",{className:"flex flex-col gap-3",children:i.map(t=>{var d;const n=(d=j.find(l=>l._id===t))==null?void 0:d.date;return e.jsxs("div",{className:"flex items-center justify-start",children:[e.jsxs("span",{className:"text-xs text-gray-500 w-32",children:["Old:"," ",new Date(n).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"})]}),e.jsx(q,{value:v[t]||"",onChange:l=>D(x=>{var o;return{...x,[t]:((o=l==null?void 0:l.toDate)==null?void 0:o.call(l))||l}}),format:"DD MMM YYYY",className:"border border-gray-300 px-2 py-1 text-sm rounded w-40",minDate:new Date})]},t)})})]}),e.jsxs("div",{className:"flex gap-3 mb-4",children:[e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"text-xs font-medium text-gray-600 mb-1 block",children:"From Time"}),e.jsxs("select",{value:S,onChange:t=>T(t.target.value),className:"w-full border border-gray-300 rounded-md px-2 py-2 text-sm bg-white",children:[e.jsx("option",{value:"",children:"Select"}),u().map(t=>e.jsx("option",{value:t,children:t},t))]})]}),e.jsxs("div",{className:"w-1/2",children:[e.jsx("label",{className:"text-xs font-medium text-gray-600 mb-1 block",children:"To Time"}),e.jsxs("select",{value:h,onChange:t=>C(t.target.value),className:"w-full border border-gray-300 rounded-md px-2 py-2 text-sm bg-white",children:[e.jsx("option",{value:"",children:"Select"}),u().map(t=>e.jsx("option",{value:t,children:t},t))]})]})]}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsx("button",{className:"w-1/2 border border-gray-300 rounded py-2 text-sm font-semibold",onClick:N,disabled:p,children:"Cancel"}),e.jsx("button",{className:"w-1/2 bg-green text-white rounded py-2 text-sm font-semibold disabled:opacity-50",disabled:p,onClick:A,children:p?"Updating...":"Reschedule"})]})]})})};function z(r=[]){if(!Array.isArray(r)||r.length===0)return"N/A";const s=r.map(j=>new Date(j.date)),N=new Date(Math.min(...s)),b=new Date(Math.max(...s));return`${N.toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"})} - ${b.toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"})}`}function se(){var k,I,$,t,n,d,l,x,o,y,E,U,F,Y;const{id:r}=H(),[s,N]=c.useState(null),[b,j]=c.useState(!0),[i,_]=c.useState(!0),[v,D]=c.useState(!1),[S,T]=c.useState(!1),[h,C]=c.useState([]),[p,P]=c.useState(!1);c.useEffect(()=>{r&&u()},[r]);const u=async()=>{try{const a=await V(r);N(a)}catch(a){console.error("Error fetching treatment by ID:",a)}finally{j(!1)}},M=async()=>{try{P(!0),await W(h,r),await u(),g.success("Payment update successfully completed!"),D(!1),C([])}catch(a){console.error("Payment update failed:",a),g.error("Failed to update payment. Try again.")}finally{P(!1)}},A=async()=>{try{if(!r)return;await X(r),g.success("Treatment marked as completed!"),await u()}catch(a){console.error("Failed to complete treatment:",a),g.error("Something went wrong while completing treatment.")}};return b?e.jsx("div",{className:"text-center mt-10 text-sm text-gray-400",children:"Loading treatment details..."}):s?e.jsxs("div",{className:"max-w-md mx-auto min-h-screen bg-white px-4 py-6 pb-32",children:[e.jsx("div",{className:"font-semibold text-md mb-4 flex justify-center",children:"Patient Details"}),e.jsxs("div",{className:"bg-white border rounded-xl p-4 shadow-sm flex flex-col gap-4",children:[e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("img",{src:((k=s==null?void 0:s.patientId)==null?void 0:k.profilePhoto)||"/homecare/user.png",alt:(I=s==null?void 0:s.patientId)==null?void 0:I.fullName,className:"w-14 h-14 rounded-full object-cover border"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-base",children:($=s==null?void 0:s.patientId)==null?void 0:$.fullName}),e.jsx("div",{className:"text-xs text-gray-500",children:"Treatment"}),e.jsx("span",{className:"text-xs text-gray-500",children:z((t=s==null?void 0:s.isTreatmentScheduled)==null?void 0:t.treatmentDate)})]})]}),e.jsx("button",{className:"p-2 hover:bg-gray-100 rounded-full",children:e.jsx(Z,{className:"w-5 h-5 text-gray-500"})})]}),e.jsx("button",{onClick:()=>T(!0),className:"border border-green text-green text-sm rounded-lg px-5 py-1 font-semibold w-full",children:"Reschedule"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 mt-3 text-xs text-gray-700",children:[e.jsxs("p",{className:"font-semibold text-gray-800 mb-1",children:[((n=s==null?void 0:s.patientId)==null?void 0:n.fullName)||"Patient","'s Address"]}),e.jsx("p",{className:"whitespace-pre-wrap leading-snug text-gray-600",children:((l=(d=s==null?void 0:s.patientId)==null?void 0:d.appointmentAddress)==null?void 0:l.replace(/\n?Lat:.*$/i,""))||"Address not available"}),e.jsx("button",{className:"bg-green hover:bg-green/90 mt-2 text-white text-xs px-4 py-1.5 rounded-md font-medium",onClick:()=>{var m;const a=(m=s==null?void 0:s.patientId)==null?void 0:m.appointmentAddress;if(!a)return alert("Address not available");const f=a.match(/Lat:\s*([-0-9.]+),\s*Lng:\s*([-0-9.]+)/),w=f?`https://www.google.com/maps?q=${f[1]},${f[2]}`:`https://www.google.com/maps?q=${encodeURIComponent(a.replace(/\n?Lat:.*$/i,""))}`;window.open(w,"_blank")},children:"📍 Locate"})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg mt-3",children:[e.jsxs("button",{className:"flex w-full items-center justify-between px-3 py-2 font-semibold text-gray-800",onClick:()=>_(!i),children:[e.jsx("span",{children:"Physio Prescription"}),i?e.jsx(G,{}):e.jsx(J,{})]}),i&&e.jsx("div",{className:"px-3 pb-3 text-xs text-gray-700",children:(s==null?void 0:s.prescriptionNotes)||"No prescription Notes."})]}),e.jsxs("div",{className:"bg-white mt-4 px-4 py-3 rounded-xl border shadow",children:[e.jsx("div",{className:"font-semibold text-base mb-2",children:"Treatment Report"}),e.jsxs("div",{className:"text-xs text-gray-700 flex flex-col gap-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Treatment Days:"}),e.jsxs("span",{children:[((o=(x=s==null?void 0:s.isTreatmentScheduled)==null?void 0:x.treatmentDate)==null?void 0:o.length)||0," Days"]})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Treatment Type:"}),e.jsx("span",{children:"Home Care"})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Treatment Duration:"}),e.jsx("span",{children:z((y=s==null?void 0:s.isTreatmentScheduled)==null?void 0:y.treatmentDate)})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"font-medium",children:"Treatment Amount:"}),e.jsxs("span",{children:["₹ ",((E=s==null?void 0:s.isTreatmentScheduled)==null?void 0:E.amount)||0]})]})]})]}),e.jsxs("div",{className:"bg-white mt-4 px-4 py-3 rounded-xl border shadow",children:[e.jsx("div",{className:"font-semibold text-base mb-2",children:"Payment Overview"}),e.jsx("div",{className:"flex flex-col gap-2",children:[...((U=s==null?void 0:s.isTreatmentScheduled)==null?void 0:U.treatmentDate)||[]].slice().reverse().map((a,f,w)=>{var m,L;return e.jsxs("div",{className:"flex justify-between text-sm border-b py-2",children:[e.jsxs("div",{children:[e.jsx("span",{className:"block text-gray-600",children:`Day ${w.length-f}`}),e.jsxs("span",{className:"text-xs text-gray-500",children:[new Date(a.date).toLocaleDateString("en-IN",{day:"2-digit",month:"short",year:"numeric"})," ","(",(m=s==null?void 0:s.isTreatmentScheduled)==null?void 0:m.startTime," -"," ",(L=s==null?void 0:s.isTreatmentScheduled)==null?void 0:L.endTime,")"]})]}),e.jsx("span",{className:`font-medium ${a.isPaid?"text-green":"text-red-500"}`,children:a.isPaid?"Paid":"Unpaid"})]},a._id)})}),e.jsx("button",{className:"mt-4 w-full bg-green text-white rounded-lg py-3 font-semibold",onClick:()=>D(!0),children:"Confirm Payment"}),(F=s==null?void 0:s.isTreatmentScheduled)!=null&&F.isTreatmentCompleted?e.jsx("button",{disabled:!0,className:"mt-4 w-full bg-white text-green border border-green rounded-lg py-3 font-semibold",children:"Already Completed"}):e.jsx("button",{className:"mt-4 w-full bg-white text-green border border-green rounded-lg py-3 font-semibold",onClick:A,children:"Complete"})]}),v&&e.jsx("div",{className:"fixed inset-0 bg-black/40 z-50 flex justify-center items-center px-3",children:e.jsxs("div",{className:"bg-white rounded-xl p-4 w-full max-w-sm shadow-xl relative",children:[e.jsx("h2",{className:"text-center font-semibold text-base mb-4",children:"Select Dates for Cash Payment Collection"}),e.jsx("div",{className:"flex flex-col gap-2 max-h-[300px] overflow-y-auto",children:(((Y=s==null?void 0:s.isTreatmentScheduled)==null?void 0:Y.treatmentDate)||[]).map((a,f)=>{var L;const w=h.includes(a._id),m=a.isPaid;return e.jsxs("div",{className:`flex justify-between items-center text-sm px-3 py-2 rounded-md border cursor-pointer ${m?"bg-green/90 text-white cursor-not-allowed":w?"bg-green/90 text-white":"bg-white"}`,onClick:()=>{m||C(R=>R.includes(a._id)?R.filter(O=>O!==a._id):[...R,a._id])},children:[e.jsxs("span",{children:["Day ",f+1]}),e.jsxs("span",{className:"font-semibold",children:["₹ ",((L=s==null?void 0:s.isTreatmentScheduled)==null?void 0:L.amount)||0," ",m||w?"Collected":"Collect"]})]},a._id)})}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsx("button",{className:"w-1/2 border border-black/20 rounded py-2 font-semibold text-sm",onClick:()=>{C([]),D(!1)},children:"Cancel"}),e.jsx("button",{className:"w-1/2 bg-green text-white rounded py-2 font-semibold text-sm disabled:opacity-50",disabled:h.length===0||p,onClick:M,children:p?"Updating...":"Confirm Payment"})]})]})}),S&&e.jsx(K,{patient:s,treatmentId:r,onClose:()=>T(!1),onRescheduleSuccess:async()=>{await u(),T(!1)}})]}):e.jsxs("div",{className:"text-center mt-10 text-sm text-red-500",children:["No treatment found for ID: ",r]})}export{se as default};
