import{c as h,d as l,u as P,e as T,f as z,j as t,r as C,k as m,I as E,O as R,w as D,_ as c,v as L}from"./index-CWqE7d4E.js";import{O as M}from"./index.esm-8FVoWTcL.js";import{O as U,l as V,s as _}from"./homecare-G6_0bD5I.js";function J({type:a="patient",phone:O}){var N;const d=h(e=>e.modalNew.otpModalOpen),w=h(e=>e.authNew.phone),{fullName:u,gender:x,date:b,dob:g}=h(e=>e.authNew),r=O||w,[v,n]=l.useState(!0),[f,o]=l.useState(60),[p,j]=l.useState(""),i=P(),I=T(),y=((N=z().state)==null?void 0:N.from)||"/homecare";l.useEffect(()=>{if(d){n(!0),o(60);const e=setInterval(()=>{o(s=>s<=1?(n(!1),clearInterval(e),0):s-1)},1e3);return()=>clearInterval(e)}},[d]);const S=async()=>{try{const e=a==="physio"?await R(r,p,a,u):await U(r,p,a,u,x,b,g);if(e.status>=200&&e.status<300){const s={userToken:e==null?void 0:e.data.token,userId:e==null?void 0:e.data.data._id,phone:e==null?void 0:e.data.data.phone};localStorage.setItem("homecareUser",JSON.stringify(s)),localStorage.setItem("homecareUserType",a),i(D(s)),i(m()),c.success("Login successful",{id:"OtpSuccessNew",className:"capitalize z-10"}),setTimeout(()=>{I(y,{replace:!0}),window.location.reload()},1500)}else c.error(e.data.message||"Invalid OTP",{id:"OtpErrorResponse",className:"capitalize z-10"})}catch(e){console.error("OTP verification error:",e),c.error("Something went wrong",{id:"OtpErrorCatch",className:"capitalize z-10"})}},k=()=>{try{a==="physio"?L(r):a==="patient"?V(r):_({fullName:u,phone:r,dob:g,gender:x}),o(60),n(!0);const e=setInterval(()=>{o(s=>s<=1?(n(!1),clearInterval(e),0):s-1)},1e3);return()=>clearInterval(e)}catch{c.error("Failed to resend OTP",{id:"OtpResendError",className:"capitalize z-10"})}};return t.jsxs(C.Dialog,{open:d,handler:()=>i(m()),className:"relative bg-white ring-1 ring-gray-300 !h-2/3 !w-1/3 text-black",children:[t.jsx(E,{size:22,className:"absolute right-1 top-1 h-6 w-6 cursor-pointer text-black",onClick:()=>i(m())}),t.jsxs("div",{className:"rounded-lg gap-8 h-full flex flex-col justify-center items-center",children:[t.jsxs("div",{className:"flex flex-col gap-1",children:[t.jsx("p",{className:"text-xl font-semibold text-center",children:"Verify OTP"}),t.jsxs("p",{className:"text-center text-sm",children:["Sent to your ",r]})]}),t.jsx(M,{value:p,onChange:j,numInputs:4,renderSeparator:t.jsx("span",{children:"     "}),renderInput:e=>t.jsx("input",{required:!0,...e,style:{width:"40px",height:"40px"},className:"outline-none text-black border border-black rounded-md text-center"})}),t.jsx("button",{onClick:S,className:"w-56 ring-1 ring-green bg-lightGreen hover:text-white py-1 hover:bg-green px-5 font-semibold text-green rounded-lg text-base",children:"Submit"}),t.jsx("div",{className:"flex justify-center items-center gap-5",children:t.jsxs("div",{className:"text-sm",children:["Didn't receive OTP?"," ",v?t.jsxs("span",{className:"text-gray-400",children:["Resend in ",Math.floor(f/60),":",(f%60).toString().padStart(2,"0")]}):t.jsx("button",{className:"underline text-green-600",onClick:k,children:"Resend"})]})})]})]})}export{J as O};
