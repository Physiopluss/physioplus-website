import{e as Y,f as L,d as m,j as e,r as C,A as o}from"./index-DPswVjmk.js";import{k as _,o as $,q as z}from"./homecare-BVlYjtuZ.js";import{C as O}from"./circle-check-big-CrRie4SV.js";import{A as q}from"./arrow-left-DQCRGrSy.js";function Q(){var y,w;const b=Y(),k=L(),{patient:r,physio:s,formData:l,selectedDate:h}=k.state||{},x=JSON.parse(localStorage.getItem("homecareUser")),p=x==null?void 0:x.userId,N=x==null?void 0:x.userToken,j=((y=s==null?void 0:s.home)==null?void 0:y.charges)||0,[c,A]=m.useState(""),[S,F]=m.useState(!1),[f,I]=m.useState(""),[t,E]=m.useState(null),[i,G]=m.useState(j),[d,g]=m.useState(j),v=h?new Date(h).toLocaleDateString(void 0,{year:"numeric",month:"long",day:"numeric"}):"",P=(l==null?void 0:l.name)||"Patient",T=a=>{if(!a)return"";const n=parseInt(a);return new Date().getFullYear()-n},B=a=>a===1?"Male":a===0?"Female":"Other";m.useEffect(()=>{if((t==null?void 0:t.status)>=200&&(t==null?void 0:t.status)<300){const{discount:a,couponType:n}=t.data;if(n===0)g(Math.max(0,i-a));else if(n===1){const u=a/100*i;g(Math.max(0,i-u))}else g(i)}else g(i)},[i,t]);const D=async()=>{var a;if(!f.trim())return o.error("Enter a coupon code");try{const n=await _(f.trim(),p,N);E(n),(n==null?void 0:n.status)>=200&&(n==null?void 0:n.status)<300?o.success("Coupon applied successfully"):o.error(((a=n==null?void 0:n.data)==null?void 0:a.message)||"Invalid coupon")}catch{o.error("Failed to apply coupon")}},M=async()=>{var a,n;if(!c)return o.error("Select payment method");try{c==="cash"?(await $({selectedDate:h,formData:l,phone:r==null?void 0:r.phone,couponId:(a=t==null?void 0:t.data)==null?void 0:a._id,amount:d,patientId:p,userToken:N,physioId:s==null?void 0:s._id}),o.success("Cash appointment booked successfully")):(await z({selectedDate:h,formData:l,phone:r==null?void 0:r.phone,couponId:(n=t==null?void 0:t.data)==null?void 0:n._id,amount:d,patientId:p,userToken:N,physioId:s==null?void 0:s._id}),o.success("Online payment successful")),F(!0)}catch(u){o.error((u==null?void 0:u.message)||"Payment failed")}};return S?e.jsxs("div",{className:"min-h-screen flex flex-col items-center justify-center bg-white px-4",children:[e.jsx(O,{className:"text-green-600 w-16 h-16 mb-4"}),e.jsx("h2",{className:"text-xl font-semibold mb-2",children:"Appointment Confirmed!"}),e.jsxs("p",{className:"text-center text-sm text-gray-600 mb-6",children:["You booked an appointment with ",e.jsx("br",{}),e.jsx("strong",{children:s==null?void 0:s.fullName})," on"," ",e.jsx("strong",{children:v})]}),e.jsx("button",{className:"bg-green text-white w-full max-w-xs py-3 rounded-xl text-sm font-medium",onClick:()=>b("/homecare/consultation-orders"),children:"Done"})]}):e.jsxs("div",{className:"max-w-sm mx-auto min-h-screen p-4 bg-white",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("button",{onClick:()=>b(-1),children:e.jsx(q,{className:"h-5 w-5 text-green-700"})}),e.jsx("h2",{className:"ml-auto mr-auto text-sm font-medium text-green",children:"Summary"})]}),e.jsxs("div",{className:"rounded-xl p-4 mb-4 text-center shadow border",children:[e.jsx("img",{src:(s==null?void 0:s.profileImage)??"https://via.placeholder.com/80",alt:s==null?void 0:s.fullName,className:"w-20 h-20 rounded-full mx-auto mb-2 object-cover"}),e.jsx("h3",{className:"text-md font-semibold border-b pb-2 mb-2",children:s==null?void 0:s.fullName}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Service:"}),e.jsx("span",{children:(s==null?void 0:s.serviceType)??"Consultation"})]}),e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{children:"Date:"}),e.jsx("span",{children:v})]})]}),e.jsx("div",{className:"space-y-2 mb-4",children:["cash","online"].map(a=>e.jsxs("label",{className:`flex items-center justify-between px-4 py-3 border rounded-lg text-sm cursor-pointer ${c===a?"bg-green/10 border-green":""}`,children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("input",{type:"radio",checked:c===a,onChange:()=>A(a)}),a==="cash"?"Cash":"Online"]}),e.jsxs("span",{className:`font-semibold ${a==="online"?"text-green-700":"text-gray-700"}`,children:["₹",a==="cash"?j:d]})]},a))}),c==="online"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"mt-6 relative flex w-full",children:[e.jsx(C.Input,{name:"coupon",placeholder:"Enter Coupon Code",className:"placeholder:text-blue-gray-300 border-none ring-1 ring-[#EAEBEC] focus:ring-green",value:f,onChange:a=>I(a.target.value)}),e.jsx(C.Button,{size:"lg",className:"!absolute right-0 py-2.5 rounded-none rounded-r bg-[#E6F4EC] text-black",onClick:D,children:"Apply"})]}),t&&e.jsx("div",{className:"my-2 text-sm",children:(t==null?void 0:t.status)>=200?e.jsxs("div",{className:"flex justify-between text-green-700",children:[e.jsx("span",{children:"Discount Applied"}),e.jsxs("span",{children:["- ₹",Math.max(0,i-d).toFixed(2)]})]}):e.jsx("div",{className:"text-red-600",children:((w=t==null?void 0:t.data)==null?void 0:w.message)||"Invalid coupon"})})]}),c&&e.jsxs("div",{className:"mt-8 mb-2 border-t pt-4 text-sm space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{children:"Sub Total"}),e.jsxs("span",{children:["₹",i.toFixed(2)]})]}),(t==null?void 0:t.status)>=200&&e.jsxs("div",{className:"flex justify-between text-green-700",children:[e.jsxs("span",{className:"text-green",children:["Discount (",f,")"]}),e.jsxs("span",{className:"text-green",children:["- ₹",(i-d).toFixed(2)]})]}),e.jsxs("div",{className:"flex justify-between font-semibold text-base",children:[e.jsx("span",{children:"Total"}),e.jsxs("span",{children:["₹",d.toFixed(2)]})]})]}),e.jsxs("div",{className:"border-t pt-4 mt-6",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:"Booking For"}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("img",{src:(r==null?void 0:r.profilePhoto)||"/homecare/user.png",alt:"patient",className:"w-9 h-9 rounded-full"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-semibold",children:P}),e.jsxs("div",{className:"text-xs text-gray-600",children:[(l==null?void 0:l.gender)||B(r==null?void 0:r.gender),","," ",(l==null?void 0:l.age)||T(r==null?void 0:r.dob)," years"]})]})]}),e.jsx("button",{onClick:()=>b(-1),className:"text-xs text-green underline",children:"Edit"})]})]}),e.jsxs("div",{className:"flex items-center justify-between border-t pt-4 mt-6",children:[e.jsxs("div",{className:"text-sm",children:[e.jsxs("span",{className:"block text-gray-600",children:["Pay by ",c||"--"]}),e.jsxs("span",{className:"font-bold",children:["₹",c==="cash"?j:d]})]}),e.jsx("button",{onClick:M,disabled:!c,className:`w-[60%] py-3 rounded-xl text-sm font-medium text-white ${c?"bg-green":"bg-green/50 cursor-not-allowed"}`,children:"Continue to Pay"})]})]})}export{Q as default};
