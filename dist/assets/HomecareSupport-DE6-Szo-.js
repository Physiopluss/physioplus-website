import{m,e as E,d as c,j as e,_ as d}from"./index-B5YKgjKu.js";import{A as b}from"./arrow-left-CftlIMTS.js";async function _(a){var r;const s=await m.get("/web/support/getTickets",{params:{patientId:a}});return(r=s==null?void 0:s.data)==null?void 0:r.data}async function D({patientId:a,email:s,summary:r}){var i;const l=await m.post("/web/support/createTicket",{patientId:a,email:s,summary:r});return(i=l==null?void 0:l.data)==null?void 0:i.data}async function I(a){var r;const s=await m.get("/web/support/getTicketById",{params:{ticketId:a}});return(r=s==null?void 0:s.data)==null?void 0:r.data}async function A(a){var r;const s=await m.post("/web/support/reopenTicket",{ticketId:a});return(r=s==null?void 0:s.data)==null?void 0:r.data}const j=[{_id:"1",email:"abhi@gmail.com",summary:"Please describe your problem...",status:"active"},{_id:"2",email:"abhi@gmail.com",summary:"Please describe your problem...",status:"closed",closedAt:Date.now()-1e3*60*60*24,detail:"PhysioPlus coins cannot be redeemed for this transaction due to specific exclusions or promotional restrictions"}];function F(){const a=JSON.parse(localStorage.getItem("homecareUser")),s=a==null?void 0:a.userId,r=E(),[l,i]=c.useState("form"),[u,N]=c.useState((a==null?void 0:a.userEmail)||""),[x,f]=c.useState(""),[p,h]=c.useState([]),[o,y]=c.useState(null),[k,g]=c.useState(!1);c.useEffect(()=>{l==="list"&&w()},[l]);async function w(){g(!0);try{const t=await _(s);h(t!=null&&t.length?t:j)}catch(t){console.warn("Falling back to demo tickets due to error:",t),h(j)}finally{g(!1)}}async function v(t){t.preventDefault();try{await D({patientId:s,email:u,summary:x}),d.success("Ticket submitted"),f(""),i("list")}catch{d.error("Failed to submit ticket. Using demo mode."),h([...p,{_id:Date.now().toString(),email:u,summary:x,status:"active"}]),i("list")}}async function S(t){try{const n=await I(t._id);y(n||t),i("detail")}catch{d.error("Failed to fetch details, showing demo data"),y(t),i("detail")}}async function T(){try{await A(o._id),d.success("Ticket reopened"),w(),i("list")}catch{d.error("Could not reopen ticket")}}function C(t){return t.status!=="closed"||!t.closedAt?!1:(Date.now()-t.closedAt)/(1e3*60*60)<=48}if(l==="form")return e.jsxs("div",{className:"w-full max-w-2xl mx-auto bg-white p-4 rounded-md",children:[e.jsxs("div",{className:"flex items-center justify-between border-b pb-3 mb-4",children:[e.jsx("button",{onClick:()=>r(-1),children:e.jsx(b,{})}),e.jsx("h2",{className:"font-semibold text-lg",children:"Help & Support"}),e.jsx("span",{className:"text-green text-sm font-medium cursor-pointer",onClick:()=>i("list"),children:"View Tickets"})]}),e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Email"}),e.jsx("input",{className:"w-full border px-3 py-2 rounded-md",type:"email",required:!0,value:u,onChange:t=>N(t.target.value),placeholder:"Enter your Email"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm mb-1",children:"Describe your problem"}),e.jsx("textarea",{className:"w-full border px-3 py-2 rounded-md h-24 resize-none",required:!0,value:x,onChange:t=>f(t.target.value),placeholder:"Write your issue..."})]}),e.jsx("button",{type:"submit",className:"w-full bg-green text-white py-2 rounded-md font-medium",children:"Submit"})]})]});if(l==="list")return e.jsxs("div",{className:"w-full max-w-2xl mx-auto bg-white p-4 rounded-md",children:[e.jsxs("div",{className:"flex items-center justify-between border-b pb-3 mb-4",children:[e.jsx("button",{onClick:()=>i("form"),children:e.jsx(b,{})}),e.jsx("h2",{className:"font-semibold text-lg",children:"Your Tickets"})]}),k?e.jsx("p",{className:"text-center text-gray-500 py-10",children:"Loading tickets..."}):p.length===0?e.jsx("p",{className:"text-center text-gray-500 py-10",children:"No tickets found."}):e.jsx("div",{className:"space-y-3",children:p.map(t=>e.jsxs("div",{className:"flex justify-between items-start border-b py-3 cursor-pointer",onClick:()=>S(t),children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:t.email}),e.jsx("p",{className:"text-xs text-gray-500",children:t.summary})]}),e.jsx("span",{className:`px-2 py-1 text-xs rounded ${t.status==="closed"?"bg-red-100 text-red-700":"bg-green-100 text-green-700"}`,children:t.status})]},t._id))})]});if(l==="detail"&&o){const t=o.status==="closed",n=C(o);return e.jsxs("div",{className:"w-full max-w-2xl mx-auto bg-white p-4 rounded-md",children:[e.jsxs("div",{className:"flex items-center justify-between border-b pb-3 mb-4",children:[e.jsx("button",{onClick:()=>i("list"),children:e.jsx(b,{})}),e.jsx("h2",{className:"font-semibold text-lg",children:"Ticket Detail"})]}),e.jsxs("div",{className:"space-y-4 mb-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"Email"}),e.jsx("p",{className:"text-sm font-medium",children:o.email})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-xs text-gray-500",children:"Issue"}),e.jsx("p",{className:"text-sm",children:o.detail||o.summary})]}),t&&e.jsx("div",{className:"bg-yellow-50 border-l-4 border-yellow-400 text-yellow-800 p-3 text-sm rounded",children:n?"You can reopen this ticket within 48 hours.":"You can no longer reopen this ticket. Please create a new one."})]}),e.jsx("button",{onClick:T,disabled:!n,className:`w-full py-2 rounded-md font-medium ${n?"bg-green text-white":"bg-gray-200 text-gray-500 cursor-not-allowed"}`,children:"Reopen Ticket"})]})}return null}export{F as default};
