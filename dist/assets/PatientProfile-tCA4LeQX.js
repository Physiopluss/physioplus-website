import{u as F,e as U,d,j as e,n as C,_ as i}from"./index-CWqE7d4E.js";import{F as M,d as $,e as r,c as E,a as n}from"./formik.esm-DzpjA8y5.js";import{L}from"./LocationPickerModal-vX6vBGr1.js";import{g as k,a as O,u as D,e as A}from"./homecare-G6_0bD5I.js";import"./x-BVEcN__w.js";const R=E().shape({name:n().required("Name is required"),phone:n().required("Phone is required"),gender:n().required("Gender is required"),dob:n().matches(/^\d{4}$/,"Enter a valid 4-digit year").required("Year of Birth is required"),address:n().required("Address is required"),pincode:n().required("Pincode is required")});function Y(){var y;const j=F(),N=U(),[g,v]=d.useState(null),[w,x]=d.useState(!1),[h,p]=d.useState(""),[P,f]=d.useState(""),[s,b]=d.useState(!1),m=((y=JSON.parse(localStorage.getItem("homecareUser")))==null?void 0:y.userId)??null,l=d.useRef(null);d.useEffect(()=>{(async()=>{if(m)try{const t=await k(m);if(!t){i.error("Patient not found");return}v({name:t.fullName||"",phone:t.phone||"",gender:t.gender||"Male",dob:t.dob||"",address:t.appointmentAddress||"",nearby:t.nearby||"",pincode:t.zipCode||"",latitude:t.latitude||"",longitude:t.longitude||""}),p(t.profilePhoto||""),f(t.profilePhoto||"")}catch{i.error("Failed to fetch patient details")}})()},[m]);const S=({address:a,nearby:t,pincode:o,lat:c,lng:u})=>{l.current&&(l.current("address",a||""),l.current("nearby",t||""),l.current("pincode",o||""),l.current("latitude",c||""),l.current("longitude",u||"")),x(!1)},I=async a=>{const t=a.currentTarget.files[0];if(t)try{const o="PhysioApps/patients",{uploadUrl:c,fileUrl:u}=await O(t,o);await D(t,c),p(u),f(u),i.success("Image uploaded successfully!")}catch{i.error("Image upload failed.")}},q=async a=>{try{const t={...a,image:P||h};await A(m,t),i.success("Profile updated successfully!"),b(!1)}catch{i.error("Failed to update profile")}};return g?e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-[#0cb46f] via-[#1aa376] to-[#0b7bb5] p-6 text-white",children:[e.jsx("h1",{className:"text-3xl flex justify-center my-4 mb-10 font-bold",children:"My Profile"}),e.jsx("div",{className:"flex items-center justify-end max-w-xl mx-auto mb-4",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:()=>b(!s),className:"bg-white text-green px-4 py-1 text-sm rounded-full shadow",children:s?"Cancel Edit":"Edit Profile"})," ",e.jsx("button",{onClick:()=>{localStorage.removeItem("homecareUser"),localStorage.removeItem("homecareUserType"),j(C()),N("/homecare")},className:"bg-red-50 text-red-700 px-4 py-1 text-sm rounded-full shadow",children:"LogOut"})]})}),e.jsx("div",{className:"max-w-xl mx-auto bg-white text-black rounded-2xl p-6 shadow-md",children:e.jsx(M,{initialValues:g,validationSchema:R,onSubmit:q,enableReinitialize:!0,children:({errors:a,touched:t,values:o,setFieldValue:c})=>(l.current=c,e.jsxs($,{className:"space-y-6",children:[e.jsxs("div",{className:"text-center relative",children:[e.jsx("img",{src:h||"https://via.placeholder.com/100",alt:"Profile",className:"w-24 h-24 rounded-full object-cover mx-auto border border-green"}),s&&e.jsxs(e.Fragment,{children:[e.jsx("label",{htmlFor:"imageUpload",className:"absolute top-2 right-[35%] bg-green text-white p-1 rounded-full text-xs cursor-pointer",children:"âœŽ"}),e.jsx("input",{id:"imageUpload",name:"image",type:"file",accept:"image/*",onChange:I,className:"hidden"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-gray-600",children:"Full Name"}),e.jsx(r,{name:"name",disabled:!s,className:`w-full border rounded-lg px-3 py-2 mt-1 text-sm ${s?"focus:ring-2 focus:ring-green":"bg-gray-100 text-gray-500 cursor-not-allowed"}`}),a.name&&t.name&&e.jsx("div",{className:"text-red-600 text-sm",children:a.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-gray-600",children:"Phone"}),e.jsx(r,{name:"phone",disabled:!0,className:"w-full bg-gray-100 border rounded-lg px-3 py-2 mt-1 text-gray-500 text-sm cursor-not-allowed"})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-gray-600",children:"Gender"}),e.jsxs(r,{as:"select",name:"gender",disabled:!s,className:`w-full border rounded-lg px-3 py-2 mt-1 text-sm ${s?"focus:ring-2 focus:ring-green bg-white":"bg-gray-100 text-gray-500 cursor-not-allowed"}`,children:[e.jsx("option",{children:"Male"}),e.jsx("option",{children:"Female"}),e.jsx("option",{children:"Other"})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-gray-600",children:"Year of Birth"}),e.jsx(r,{type:"number",name:"dob",placeholder:"1999",disabled:!s,className:`w-full border rounded-lg px-3 py-2 mt-1 text-sm ${s?"focus:ring-2 focus:ring-green":"bg-gray-100 text-gray-500 cursor-not-allowed"}`}),a.dob&&t.dob&&e.jsx("div",{className:"text-red-600 text-sm",children:a.dob})]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-gray-600",children:"Address"}),e.jsx(r,{name:"address",disabled:!s,className:`w-full border rounded-lg px-3 py-2 mt-1 text-sm ${s?"focus:ring-2 focus:ring-green":"bg-gray-100 text-gray-500 cursor-not-allowed"}`}),s&&e.jsx("div",{className:"text-right mt-1",children:e.jsx("button",{type:"button",onClick:()=>x(!0),className:"text-xs text-green underline",children:"Use Current Location"})})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-gray-600",children:"Nearby (Optional)"}),e.jsx(r,{name:"nearby",disabled:!s,className:`w-full border rounded-lg px-3 py-2 mt-1 text-sm ${s?"focus:ring-2 focus:ring-green":"bg-gray-100 text-gray-500 cursor-not-allowed"}`})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-semibold text-gray-600",children:"Pincode"}),e.jsx(r,{name:"pincode",disabled:!s,className:`w-full border rounded-lg px-3 py-2 mt-1 text-sm ${s?"focus:ring-2 focus:ring-green":"bg-gray-100 text-gray-500 cursor-not-allowed"}`}),a.pincode&&t.pincode&&e.jsx("div",{className:"text-red-600 text-sm",children:a.pincode})]})]}),e.jsx(r,{type:"hidden",name:"latitude"}),e.jsx(r,{type:"hidden",name:"longitude"}),s&&e.jsx("div",{className:"text-center",children:e.jsx("button",{type:"submit",className:"bg-green text-white px-6 py-2 rounded-full hover:bg-green/90 transition",children:"Save Changes"})})]}))})}),e.jsx(L,{isOpen:w,onClose:()=>x(!1),onLocationSelect:S})]}):e.jsx("div",{className:"text-center text-white",children:"Loading..."})}export{Y as default};
